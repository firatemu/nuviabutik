{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .report-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .filter-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .summary-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #28a745;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .transaction-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 3px solid #007bff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        transition: transform 0.2s ease;
    }
    
    .transaction-card:hover {
        transform: translateY(-1px);
    }
    
    .return-card {
        border-left-color: #dc3545;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .stat-box {
        text-align: center;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        margin-top: 5px;
    }
    
    .positive { color: #28a745; }
    .negative { color: #dc3545; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="report-header">
        <h2><i class="fas fa-calendar-day me-3"></i>{{ title }}</h2>
        <p class="mb-0">Günlük satış performans detayları</p>
    </div>

    <!-- Filtreler -->
    <div class="filter-card">
        <h5><i class="fas fa-filter me-2"></i>Filtreler</h5>
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label for="satici" class="form-label">Satış Elemanı</label>
                <select name="satici" id="satici" class="form-select">
                    <option value="">Satış Elemanı Seçiniz</option>
                    {% for elemanl in satis_elemanlari %}
                    <option value="{{ elemanl.id }}" {% if secili_satici.id == elemanl.id %}selected{% endif %}>
                        {{ elemanl.first_name }} {{ elemanl.last_name|default:elemanl.username }}
                        {% if elemanl.role == 'admin' %} (Yönetici)
                        {% elif elemanl.role == 'manager' %} (Müdür)
                        {% elif elemanl.role == 'cashier' %} (Kasiyer)
                        {% elif elemanl.role == 'satici' %} (Satış Elemanı)
                        {% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="tarih" class="form-label">Tarih</label>
                <input type="date" name="tarih" id="tarih" class="form-control" value="{{ secili_tarih|date:'Y-m-d' }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">&nbsp;</label>
                <div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Filtrele
                    </button>
                    <a href="{% url 'satis:satici_rapor' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Ana Rapor
                    </a>
                </div>
            </div>
        </form>
    </div>

    {% if secili_satici %}
    <!-- Günlük Özet -->
    <div class="summary-card">
        <h5><i class="fas fa-chart-bar me-2"></i>{{ secili_satici.first_name }} {{ secili_satici.last_name|default:secili_satici.username }} - {{ secili_tarih|date:"d F Y" }}</h5>
        
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-value positive">{{ gunluk_ozet.satis_tutari|floatformat:2 }} ₺</div>
                <div class="stat-label">Toplam Satış</div>
                <small class="text-muted">({{ gunluk_ozet.satis_adedi }} işlem)</small>
            </div>
            <div class="stat-box">
                <div class="stat-value negative">{{ gunluk_ozet.iade_tutari|floatformat:2 }} ₺</div>
                <div class="stat-label">Toplam İade</div>
                <small class="text-muted">({{ gunluk_ozet.iade_adedi }} işlem)</small>
            </div>
            <div class="stat-box">
                <div class="stat-value {% if gunluk_ozet.net_satis > 0 %}positive{% elif gunluk_ozet.net_satis < 0 %}negative{% else %}text-muted{% endif %}">
                    {{ gunluk_ozet.net_satis|floatformat:2 }} ₺
                </div>
                <div class="stat-label">Net Satış</div>
                <small class="text-muted">
                    {% if gunluk_ozet.satis_tutari > 0 %}
                        ({% widthratio gunluk_ozet.net_satis gunluk_ozet.satis_tutari 100 %}% net oran)
                    {% endif %}
                </small>
            </div>
        </div>
    </div>

    <!-- Satış Detayları -->
    {% if satislar %}
    <div class="row">
        <div class="col-lg-8">
            <h5><i class="fas fa-shopping-cart me-2"></i>Satış İşlemleri ({{ satislar.count }})</h5>
            {% for satis in satislar %}
            <div class="transaction-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">
                            <a href="{% url 'satis:detay' satis.pk %}" class="text-decoration-none">
                                {{ satis.siparis_no }}
                            </a>
                        </h6>
                        <small class="text-muted">
                            {{ satis.siparis_tarihi|date:"H:i" }} - 
                            {% if satis.musteri %}{{ satis.musteri.ad }} {{ satis.musteri.soyad }}{% else %}Genel Müşteri{% endif %}
                        </small>
                    </div>
                    <div class="text-end">
                        <strong class="positive">{{ satis.toplam_tutar|floatformat:2 }} ₺</strong>
                        <br>
                        <small class="text-muted">{{ satis.satisdetay_set.count }} kalem</small>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="col-lg-4">
            {% if iadeler %}
            <h5><i class="fas fa-undo me-2"></i>İade İşlemleri ({{ iadeler.count }})</h5>
            {% for iade in iadeler %}
            <div class="transaction-card return-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">{{ iade.kod }}</h6>
                        <small class="text-muted">{{ iade.olusturma_tarihi|date:"H:i" }}</small>
                    </div>
                    <div class="text-end">
                        <strong class="negative">-{{ iade.tutar|floatformat:2 }} ₺</strong>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        {{ secili_tarih|date:"d F Y" }} tarihinde {{ secili_satici.first_name }} {{ secili_satici.last_name|default:secili_satici.username }} tarafından satış işlemi yapılmamıştır.
    </div>
    {% endif %}
    
    {% else %}
    <div class="alert alert-warning">
        <i class="fas fa-user-times me-2"></i>
        Rapor görüntülemek için satış elemanı seçiniz.
    </div>
    {% endif %}
</div>
{% endblock %}